<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Constru App | Administrator De Obra</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <link rel="stylesheet" href="../administrator/dist/css/fine-uploader-new.css">
    <link rel="stylesheet" href="../administrator/plugins/select2/css/select2.min.css">






    <style>
        #imageUpload {
            display: none;
        }

        #profileImage {
            cursor: pointer;
        }

        #profile-container {
            width: 100%;
            height: 200px;
            overflow: hidden;

        }

        #profile-container img {
            width: 200px;
            height: 200px;


        }

        .select2-selection__arrow {
            height: 34px !important;
        }

        #trigger-upload {
            color: white;
            background-color: #00ABC7;
            font-size: 14px;
            padding: 7px 20px;
            background-image: none;
        }

        #fine-uploader-manual-trigger .qq-upload-button {
            margin-right: 15px;
        }

        #fine-uploader-manual-trigger .buttons {
            width: 36%;
        }

        #fine-uploader-manual-trigger .qq-uploader .qq-total-progress-bar-container {
            width: 60%;
        }

        small {
            color: red;
        }
    </style>


</head>

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">


        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__shake" src="../img/AdminLTELogo.png"  height="60" width="60">
          </div>
          <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
              </li>
              <li class="nav-item d-none d-sm-inline-block">
                <a href="#" class="nav-link">Nueva Obra</a>
              </li>
      
            </ul>
            <ul class="navbar-nav ml-auto">
      
              <li class="nav-item dropdown">
                <a class="nav-link" id="user" data-toggle="dropdown" href="#"></a>
                <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                  <a href="../controllers/logout.php" class="dropdown-item">Logout</a>
      
      
                </div>
              </li>
      
            </ul>
          </nav>
      
          <aside class="main-sidebar sidebar-dark-primary elevation-4">
      
            <a href="#" class="brand-link">
              <p class="brand-text font-weight-light" style="text-align: center; font-size: 30px; letter-spacing: 1px">CONSTRU
                <strong>APP</strong>
              </p>
            </a>
      
      
            <div class="sidebar">
      
              <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
      
                  <i class="fas fa-search fa-user" style="font-size: 24px; color: #fff; margin-top: 12px"></i>
                </div>
                <div class="info">
                  <a href="#" class="d-block" id="sidebar_username"></a>
                  <a class="d-block" id="sidebar_user_role" style="font-size: 14px; color: #fff; font-weight: 500; letter-spacing: 1px;"></a>
                </div>
              </div>
      
      
      
              <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
      
                  <li class="nav-header" style="letter-spacing: 1px;">ADMINISTRATOR DE OBRA</li>
      
                  <li class="nav-item">
                    <a href="#" class="nav-link">
                      <i class="nav-icon fas fa-city"></i>
                      <p>
                        Obra
                        <i class="right fas fa-angle-left"></i>
                      </p>
                    </a>
                    <ul class="nav nav-treeview">
                      <li class="nav-item">
                        <a href="constructions.html" class="nav-link">
                          <i class="fas fa-list nav-icon"></i>
                          <p>Lista de Obra</p>
                        </a>
                      </li>
                      <li class="nav-item">
                        <a href="index.html" class="nav-link">
                          <i class="far fa-circle text-info nav-icon"></i>
                          <p>Nueva Obra</p>
                        </a>
                      </li>
                      
      
                    </ul>
                  </li>
                  <li class="nav-item">
                    <a href="#" class="nav-link">
                      <i class="nav-icon fas fa-copy"></i>
                      <p>
                        Documentos
                        <i class="right fas fa-angle-left"></i>
                      </p>
                    </a>
                    <ul class="nav nav-treeview">
                      <li class="nav-item">
                        <a href="documents.html" class="nav-link">
                          <i class="fas fa-folder-open nav-icon"></i>
                          <p>Ver documentos</p>
                        </a>
                      </li>
                      <li class="nav-item">
                        <a href="special-document.html" class="nav-link">
                          <i class="far fa-circle nav-icon text-info"></i>
                          <p>Nueva Documento</p>
                        </a>
                      </li>
                     
      
                    </ul>
                  </li>
                  <li class="nav-item">
                    <a href="#" class="nav-link">
                      <i class="nav-icon fas fa-feather-alt"></i>
                      <p>
                        Multas Y Amonestaciones
                        <i class="right fas fa-angle-left"></i>
                      </p>
                    </a>
                    <ul class="nav nav-treeview">
                      <li class="nav-item">
                        <a href="construction-fines.html" class="nav-link">
                          <i class="fas fa-list nav-icon"></i>
                          <p>Multas Obra</p>
                        </a>
                      </li>
      
      
                      <li class="nav-item">
                        <a href="fine_construction.html" class="nav-link">
                          <i class="far fa-circle nav-icon text-info"></i>
                          <p>Nueva Multa Obra</p>
                        </a>
                      </li>
                    
                      <li class="nav-item">
                        <a href="workers-fines.html" class="nav-link">
                          <i class="fas fa-list nav-icon"></i>
                          <p>Amonestaciones Trabajadores</p>
                        </a>
                      </li>
                      <li class="nav-item">
                        <a href="fine-worker.html" class="nav-link">
                          <i class="far fa-circle nav-icon text-info"></i>
                          <p>Nueva Amonestacion De Trabajador</p>
                        </a>
                      </li>
      
                    </ul>
                  </li>
      
      
                  <li class="nav-item">
                    <a href="workers.html" class="nav-link">
                      <i class="fas fa-user-friends nav-icon"></i>
                      <p>Trabajadores
                      </p>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="new-worker.html" class="nav-link">
                      <i class="fas fa-user-plus nav-icon"></i>
                      <p>Agregar Trabajador/a
                      </p>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="requests.html" class="nav-link">
                      <i class="fas fa-list nav-icon"></i>
                      <p>Ver Solicitudes</p>
                    </a>
                   
                  </li>
                  <li class="nav-item">
                    <a href="comments.html" class="nav-link">
                      <i class="fas fa-comments nav-icon"></i>
                      <p>Comentarios</p>
                    </a>
                   
                  </li>
                  
      
      
      
      
                  <li class="nav-item">
                    <a href="../controllers/logout.php" class="nav-link">
                      <i class="nav-icon far fa-circle text-warning"></i>
                      <p>Logout</p>
                    </a>
                  </li>
      
                </ul>
              </nav>
      
            </div>
      
          </aside>

        <div class="content-wrapper" style="overflow: hidden">
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>Nueva Multa Obra</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Nueva Multa Obra</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </section>
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">


                            <div class="card card-default">

                                <form href="#" id="FineForm">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label
                                                                style="font-weight: 500; font-size: 14px">Obra</label>
                                                            <select class="form-control form-control-sm"
                                                                id="construction" name="construction">
                                                                <option value="">Seleccionar Obra</option>

                                                            </select>
                                                            <small></small>
                                                        </div>

                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label
                                                                style="font-weight: 500; font-size: 14px">Empresa</label>
                                                            <input type="text" class="form-control form-control-sm"
                                                                id="business" name="business" readonly />
                                                            <small></small>
                                                        </div>

                                                    </div>


                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label
                                                                style="font-weight: 500; font-size: 14px">Partida</label>
                                                            <input type="text" class="form-control form-control-sm"
                                                                id="departure" name="departure" />

                                                            <small></small>
                                                        </div>

                                                    </div>

                                                </div>

                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label style="font-weight: 500; font-size: 14px">Tipo De
                                                                Multa</label>
                                                            <input type="text" class="form-control form-control-sm"
                                                                id="fine_type" name="fine_type" />

                                                            <small></small>
                                                        </div>

                                                    </div>

                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label
                                                                style="font-weight: 500; font-size: 14px">Observacion</label>
                                                            <textarea class="form-control form-control-sm" rows="5"
                                                                id="observation" name="observation"></textarea>

                                                            <small></small>
                                                        </div>

                                                    </div>

                                                </div>

                                            </div>
                                            <div class="col-md-4 mx-auto text-center">
                                                <label
                                                    style="font-weight: 500; font-size: 14px; margin-bottom: 10px;">Imagen
                                                    De Perfil Del Sitio De Construcción</label>

                                                <div id="profile-container">

                                                    <image id="profileImage" src="./dist/img/default.jpg" />
                                                </div>
                                                <input id="imageUpload" type="file" name="profile_photo"
                                                    placeholder="Photo" required="" capture>
                                                <small id="profile_error"></small>



                                            </div>



                                        </div>

                                        <div class="row">
                                            <div class="col-lg-12">
                                                <h4>Subir archivo (Prueba O Documentacion)</h4>
                                                <div id="fine-uploader-manual-trigger"></div>
                                                <small></small>


                                            </div>

                                        </div>
                                        <div class="row" style="margin-top: 40px">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <button class="btn btn-primary"
                                                        style="float: right; margin-bottom: 20px"
                                                        type="submit">Entregar</button>

                                                </div>

                                            </div>

                                        </div>





                                    </div>
                                </form>

                            </div>

                        </div>

                    </div>

                </div>

            </section>

        </div>

        <footer class="main-footer">
            <p style="text-align: center">Copyright &copy; 2021 <a href="#">ConstruApp</a>. All rights reserved.</p>


        </footer>
        <aside class="control-sidebar control-sidebar-dark">
        </aside>
    </div>

    <script src="plugins/jquery/jquery.min.js"></script>
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="plugins/jszip/jszip.min.js"></script>
    <script src="plugins/pdfmake/pdfmake.min.js"></script>
    <script src="plugins/pdfmake/vfs_fonts.js"></script>
    <script src="plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="dist/js/adminlte.min.js"></script>
    <script src="dist/js/demo.js"></script>
    <script src="dist/js/functions.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.3.5/js/locales/nl.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/0.8.3/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.4.2/Sortable.js"></script>
    <script src="dist/js/functions.js"></script>
    <script src="../administrator/dist/js/jquery.fine-uploader.js"></script>
    <script src="../administrator/plugins/select2/js/select2.min.js"></script>
    <script src="dist/js/jquery.validate.min.js"></script>
    <script src="dist/js/additional-methods.min.js"></script>
    




    <script type="text/template" id="qq-template-manual-trigger">
        <div class="qq-uploader-selector qq-uploader" qq-drop-area-text="Drop files here">
            <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
                <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
            </div>
            <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
                <span class="qq-upload-drop-area-text-selector"></span>
            </div>
            <div class="buttons">
                <div class="qq-upload-button-selector qq-upload-button">
                    <div>Archivos</div>
                </div>
                
            </div>
            <span class="qq-drop-processing-selector qq-drop-processing">
                <span>Procesando Archivos Caídos...</span>
                <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
            </span>
            <ul class="qq-upload-list-selector qq-upload-list" aria-live="polite" aria-relevant="additions removals">
                <li>
                    <div class="qq-progress-bar-container-selector">
                        <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-progress-bar-selector qq-progress-bar"></div>
                    </div>
                    <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
                    <img class="qq-thumbnail-selector" qq-max-size="100" qq-server-scale>
                    <span class="qq-upload-file-selector qq-upload-file"></span>
                    <span class="qq-edit-filename-icon-selector qq-edit-filename-icon" aria-label="Edit filename"></span>
                    <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
                    <span class="qq-upload-size-selector qq-upload-size"></span>
                    <button type="button" class="qq-btn qq-upload-cancel-selector qq-upload-cancel">Cancelar</button>
                    <button type="button" class="qq-btn qq-upload-retry-selector qq-upload-retry">Rever</button>
                    <button type="button" class="qq-btn qq-upload-delete-selector qq-upload-delete">Borrar</button>
                    <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
                </li>
            </ul>

            <dialog class="qq-alert-dialog-selector">
                <div class="qq-dialog-message-selector"></div>
                <div class="qq-dialog-buttons">
                    <button type="button" class="qq-cancel-button-selector">Close</button>
                </div>
            </dialog>

            <dialog class="qq-confirm-dialog-selector">
                <div class="qq-dialog-message-selector"></div>
                <div class="qq-dialog-buttons">
                    <button type="button" class="qq-cancel-button-selector">No</button>
                    <button type="button" class="qq-ok-button-selector">Yes</button>
                </div>
            </dialog>

            <dialog class="qq-prompt-dialog-selector">
                <div class="qq-dialog-message-selector"></div>
                <input type="text">
                <div class="qq-dialog-buttons">
                    <button type="button" class="qq-cancel-button-selector">Cancel</button>
                    <button type="button" class="qq-ok-button-selector">Ok</button>
                </div>
            </dialog>
        </div>
    </script>


    <!-- <script src="https://releases.transloadit.com/uppy/v1.31.0/uppy.min.js"></script> -->
    <script>
        $("#profileImage").click(function (e) {
            $("#imageUpload").click();
        });

        function fasterPreview(uploader) {
            if (uploader.files && uploader.files[0]) {
                $('#profileImage').attr('src',
                    window.URL.createObjectURL(uploader.files[0]));
            }
        }

        $("#imageUpload").change(function () {
            fasterPreview(this);
        });
    </script>


    <script>
        $(document).ready(function () {
            
            $("#FineForm").on("submit", function (e) {
                e.preventDefault();
                var files = $('#fine-uploader-manual-trigger').fineUploader('getUploads');
                var valid = $("#FineForm").valid();
                if (valid == true) {
                    var form = $("#FineForm")[0];
                    var formData = new FormData(form);
                    formData.append("action", "obra_fine");
                    $.each(files, function (index, item) {
                        formData.append("documents[]", item["file"]);

                    });

                    $.ajax({
                        url: "../controllers/administrator.php",
                        data: formData,
                        processData: false,
                        contentType: false,
                        dataType: "JSON",
                        type: 'POST',
                        success: function (response) {
                            if (response["login"] == false) {
                                window.location.href = "../index.html";

                            }
                            if (response["login"] == true) {
                                if (response["status"] == true) {
                                    alert("Bien Agregado con éxito");
                                    window.location.reload();
                                }
                                if (response["status"] == false) {
                                    alert("Ocurrió Un Error. Por Favor, Inténtelo De Nuevo Más Tarde");
                                }

                            }
                        },

                    });

                }



            });


            $("#FineForm").validate({
                rules:
                {
                    construction:
                    {
                        required: true,

                    },
                    departure:
                    {
                        required: true,
                    },
                    fine_type:
                    {
                        required: true,
                    },
                    observation:
                    {
                        required: true,
                    },

                },
                messages:
                {
                    construction:
                    {
                        required: "Este Campo Es Obligatorio",

                    },
                    departure:
                    {
                        required: "Este Campo Es Obligatorio",
                    },
                    fine_type:
                    {
                        required: "Este Campo Es Obligatorio",
                    },
                    observation:
                    {
                        required: "Este Campo Es Obligatorio",
                    }

                },
                errorPlacement: function (error, element) {

                    $(element).next("small").text($(error).text());
                },
                success: function (element) {
                    $(element).next("small").text("");
                },

            });

            var res = getUser();
            if (res["login"] == false) {
                window.location.href = "../index.html";
            }
            if (res["user"]) {

                $("#user").text(res["user"]["NAME"]);
                $("#user_role").text(res["user"]["DESIGNATION"]);
                $("#userside").text(res["user"]["NAME"]);

            }
            var res = getConstructions();
            if (res["login"] == false) {
                window.location.href = "../index.html";
            }
            if (res["login"] == true && res["lov_const"]) {
                jQuery.each(res["lov_const"], function (index, value) {

                    $("#construction").append("<option value=" + value['CONS_ID'] + " style='text-transform: initial'>" + value['NAME'] + "</option>");

                });


            }


            $('#fine-uploader-manual-trigger').fineUploader({
                template: 'qq-template-manual-trigger',
                autoUpload: false,
                validation: {
                    allowedExtensions: ['pdf', 'docx', 'doc', 'txt']
                },

            });


            $("#construction").select2();
            $("#construction").on("change", function () {
                var const_ID = $("#construction").val();
                if (const_ID) {
                    $.ajax({
                        type: "POST",
                        url: "../controllers/administrator.php",
                        dataType: "JSON",
                        data: { action: "get_data_by_const_ID", const_ID: const_ID },
                        success: function (response) {
                            if (response["login"] == false) {
                                window.location.href = "../index.html";
                            }
                            if (response["login"] == true) {
                                if (response["construction"]) {
                                    $("#business").val(response["construction"]["BUSINESS"].initCap());
                                    if(response["construction"]["IMG_NAME"] != null)
                                    {
                                        $('#profileImage').attr('src', './uploads/constructions/' + response["construction"][11]);


                                    }
                                    if(response["construction"]["IMG_NAME"] == null)
                                    {
                                        $('#profileImage').attr('src', 'dist/img/default.jpg');


                                    }
                                    

                                }

                            }

                        }

                    });
                }


            });
            var fine_ID = getParameterFromUrl("Id", window.location.href);
            if (fine_ID != "" && fine_ID != undefined & fine_ID != null) {
                $.ajax({
                    url: "../controllers/administrator.php",
                    data: {"action": "get_fine_by_id", fine_ID: fine_ID},
                    dataType: "JSON",
                    type: 'POST',
                    success: function (response) {
                        if (response["login"] == false) {
                            window.location.href = "../index.html";

                        }
                        if (response["login"] == true) {
                            if (response["status"] == true) {
                                if(response["FINE"] && response["FINE"] != "")
                                {
                                    $('#construction').val(response["FINE"]["CONSTRUCTION_ID"]).trigger('change');
                                    $('#departure').val(response["FINE"]["PARTIDA"]);
                                    $('#fine_type').val(response["FINE"]["TIPO_MULTA"]);
                                    $('#observation').val(response["FINE"]["REASON"]);
                                  

                                }
                                
                            }
                            

                        }
                    },

                });



            }



        });










    </script>
</body>

</html>